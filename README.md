# 📦 Serverless RDS Cluster Provisioning Automation

This project provides a **serverless, automated solution** for provisioning RDS instances (MySQL/PostgreSQL) on-demand using AWS services, GitHub, Terraform, and CircleCI.

Developers can trigger instance creation by calling a public API and providing the following parameters:
- ✅ `database_name`
- ✅ `database_engine` (`mysql` / `postgres`)
- ✅ `environment` (`dev` / `prod`)

A pull request is automatically generated with the relevant Terraform configuration, enabling infrastructure creation via GitOps.

---

## 🚀 Architecture Overview

```

Client --> API Gateway --> Lambda (API Handler) --> SNS --> SQS --> Lambda (Queue Consumer) --> GitHub PR (Terraform)


````

- **API Gateway**: Public HTTP endpoint (supports custom domain).
- **Lambda (API Handler)**: Receives requests and publishes messages to SNS.
- **SNS → SQS**: Ensures reliable and decoupled request processing.
- **Lambda (Queue Consumer)**: Generates Terraform code and creates a GitHub Pull Request.
- **CircleCI**: Deploys serverless stack and applies Terraform when PR is merged.

---

## 🧰 Tech Stack

| Area             | Tools / Services                             |
| ---------------- | -------------------------------------------- |
| IaC              | AWS SAM (Serverless) + Terraform             |
| CI/CD            | CircleCI                                     |
| AWS Services     | Lambda, API Gateway, SNS, SQS, SecretsManager|
| Languages        | Python 3.11, Terraform                       |
| GitOps           | GitHub + GitHub PR API                       |

---

## 🛠️ Deployment Instructions

### 1. 🔐 Prerequisites

- AWS Account with admin access
- GitHub token stored in AWS Secrets Manager (`github-token`)
- Terraform configured with backend (optional)
- Custom domain purchased + verified (optional)

### 2. 🧪 Clone the Repo

```bash
git clone https://github.com/your-username/serverless-rds-cluster-automation.git
cd serverless-rds-cluster-automation
````

### 3. 🚀 Deploy SAM stack

You can deploy manually using:

```bash
cd sam
sam build
sam deploy --guided
```

Or rely on the automated CircleCI pipeline.

### 4. ✅ Test the API

```bash
curl -X POST https://<your-api-endpoint>/provision-rds \
  -H "Content-Type: application/json" \
  -d '{
        "database_name": "mydb123",
        "database_engine": "mysql",
        "environment": "prod"
      }'
```

Expected Response:

```json
{
  "message": "Request accepted",
  "sns_message_id": "..."
}
```

---

## ⚙️ CircleCI Pipeline

The `.circleci/config.yml` file automates the following:

* On `main` branch:

  * Deploys SAM stack.
  * Applies Terraform changes (if `.tf` files changed).

PRs generated by Lambda will create new `.tf` files for RDS provisioning.
Once the PR is merged → CircleCI will apply the change automatically.

---

## 📁 Project Structure

```
.
├── .circleci/
│   └── config.yml              # CI/CD pipeline (SAM + Terraform)
├── sam/
│   └── template.yaml           # AWS SAM template
├── terraform/
│   └── *.tf                    # Generated RDS resource definitions
├── lambda/
│   └── handler.py              # Lambda code (API + SQS consumer)
└── README.md
```

---

## 🧠 Behavior Based on `environment`

| Environment | Instance Class |
| ----------- | -------------- |
| dev         | db.t3.micro    |
| prod        | db.t3.medium   |

*You can easily modify the `ENV_INSTANCE_CLASSES` mapping in code.*

---

## 🔐 Security Considerations

* GitHub tokens are stored securely using **Secrets Manager**.
* Terraform `db_password` references the secret dynamically (not exposed).
* IAM permissions follow least-privilege principle.
* All logs are written to **CloudWatch** using `logging`.

---



---

